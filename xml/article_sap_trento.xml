<?xml version="1.0" encoding="UTF-8"?>
<?xml-model href="file:/usr/share/xml/geekodoc/rng/geekodoc5-flat.rnc"
   type="application/relax-ng-compact-syntax"?>
<!DOCTYPE article
[
  <!ENTITY % entities SYSTEM "generic-entities.ent">
    %entities;

  <!-- Trento specific entities -->
  <!ENTITY trentopremium        "Trento Premium">
  <!ENTITY trentoadmin          "trentoservice">
  <!ENTITY trentoserverip       "192.168.1.2">
  <!ENTITY trentoservername     "<replaceable
    xmlns='http://docbook.org/ns/docbook'>TRENTO_SERVER_HOSTNAME</replaceable>">
  <!ENTITY trentoagentname      "<replaceable xmlns='http://docbook.org/ns/docbook'>TRENTO_AGENT</replaceable>">
  <!ENTITY trentoprompt         "&trentoadmin;@&trentoservername;:~>">
  <!ENTITY trentoagentprompt    "&trentoadmin;@&trentoagentname;:~>">
  <!ENTITY trentoserver.prompt  "<prompt xmlns='http://docbook.org/ns/docbook'>&trentoprompt; </prompt>">
  <!ENTITY trentoagent.prompt   "<prompt xmlns='http://docbook.org/ns/docbook'>&trentoagentprompt; </prompt>">
  <!ENTITY t.server             "Trento Server">
  <!ENTITY t.agent              "Trento Agent">
  <!ENTITY t.web                "Trento web console">
  <!ENTITY k8s                  "Kubernetes">
  <!ENTITY rancher.k8s.engine   "Rancher &k8s; Engine">
]>

<!--

2021-11-18
As agreed on https://confluence.suse.com/x/DAEcN on our Trento doc kick off

-->

<article xml:lang="en" xml:id="article-sap-trento" version="5.1" status="draft"
    xmlns="http://docbook.org/ns/docbook"
    xmlns:xi="http://www.w3.org/2001/XInclude"
    xmlns:xlink="http://www.w3.org/1999/xlink">
  <title>Getting started with &trentopremium;</title>
  <subtitle>&sles4sapreg;</subtitle>
  <info>
    <abstract>
      <para>
       &trentopremium; is an open cloud-native web console that aims to help
       &sap; administrators to improve monitoring and checking of &sap;
       Applications.
      </para>
    </abstract>
    <xi:include href="common_copyright_gfdl.xml" />
    </info>

  <important>
    <title>Trento is an evolving product</title>
    <para> The product is under active development, and it currently
      supports only selected customers with the purpose of collecting
            their feedback. If you'd like to join the program, contact us at
                <email>trento-project@suse.com</email>. </para>
  </important>

  <section xml:id="sec-trento-what">
    <title>What is &trentopremium;?</title>
    <para>
      &trentopremium; is the extended version of the Trento community project containing
      additional checks. Apart from their naming, both are a comprehensive monitoring
      solutions consisting of two main components, the &t.server; and the &t.agent;.
      Both Trento variants provide the following features:
    </para>
    <!--
      from https://confluence.suse.com/x/uoOyN
    -->
    <itemizedlist>
      <listitem>
        <para>A simplified web UI targeting &sap; admins. </para>
      </listitem>
      <listitem>
        <para>Automated discovery of &sap; Systems, &sap; Instances, and
          &hana; clusters.</para>
      </listitem>
      <listitem>
        <para>Configuration validation for &hana; Scale-Up
          Performance-Optimized scenarios deployed on MS Azure
          cloud.</para>
      </listitem>
    </itemizedlist>

    <para> The <emphasis role="strong">&t.server;</emphasis> is an
      independent, cloud-native, distributed system and designed to run
      on a &k8s; cluster.
      The &t.server; interacts with users via a web front end.
    </para>
    <para> The <emphasis role="strong">&t.agent;</emphasis> is a single
      background process (<systemitem>trento agent</systemitem>) running
      on each host of the SAP infrastructure that is monitored.
    </para>
    <para> For Trento, &suse; collects telemetry data relevant for further
      product development. </para>
    <para> See <xref linkend="fig-trento-architecture" /> for additional
      details. </para>
    <!-- toms 2021-11-26: Do we have a vector graphic for this?
      https://github.com/trento-project/trento/blob/main/docs/trento-architecture.svg.
    -->
    <figure xml:id="fig-trento-architecture">
      <title>Architectural overview</title>
      <mediaobject>
        <imageobject>
          <imagedata width="80%"
            fileref="trento-architecture-outline.png" />
          <!-- Source: https://confluence.suse.com/display/SAP/Architecture -->
        </imageobject>
      </mediaobject>
    </figure>
  </section>

  <section xml:id="sec-trento-product-lifecycle-update-strategy">
    <title>Product lifecycle and update strategy</title>
    <!--
      Most ist taken from https://confluence.suse.com/x/uoOyN
    -->
    <para>The main components have different product lifecycles:</para>

    <variablelist>
      <varlistentry>
        <term>&t.agent;</term>
        <listitem>
          <formalpara>
            <title>Delivery mechanism:</title>
            <para>RPM package for &productname; 15&nbsp;SP1 and
              newer.</para>
          </formalpara>
          <formalpara>
            <title>Supported runtime:</title>
            <para> Supports &productname; 15&nbsp;SP1 and newer.
            </para>
          </formalpara>
        </listitem>
      </varlistentry>
      <varlistentry>
        <term>&t.server;</term>
        <listitem>
          <formalpara>
            <title>Delivery mechanism:</title>
            <para> A set of container images from the &suse;
              registry together with a Helm chart for easy
              installation. </para>
          </formalpara>
          <formalpara>
            <title>&k8s;:</title>
            <para> The &t.server; runs on any current Cloud Native
              Computing Foundation (CNCF) certified &k8s;
              distributions. Depending on your background and
              needs, &suse; support several usage scenarios:
            </para>
          </formalpara>
          <itemizedlist>
            <listitem>
              <para> If you already use a CNCF certified &k8s;,
                you can run the &t.server; in it. </para>
            </listitem>
            <listitem>
              <para> If you have no &k8s; and want enterprise
                support, &suse; recommends &suse; Rancher with
                &rancher.k8s.engine; (RKE) either version 1 or
                2. </para>
            </listitem>
            <listitem>
              <para> If you do not have &k8s; and you do not need
                professional support, &suse; recommends using
                K3s which can be installed on a single host.
              </para>
            </listitem>
          </itemizedlist>
        </listitem>
      </varlistentry>
    </variablelist>

    <remark>toms 2021-12-09: what about the update strategy? aj: something
      for next year. :) </remark>
  </section>

<!--
 toms 2021-11-19:
 Do we have specific terms which needs to be explained in a terminology section?
-->

  <section xml:id="sec-trento-requirements">
    <title>Requirements</title>
    <para> This section describes requirements for the &t.server; and its
      &t.agent;s. </para>
    <section xml:id="sec-trento-server-requirements">
      <title>&t.server; requirements</title>
      <para> Running all the &t.server; components requires a minimum of 2GB of RAM, 
       two CPU cores and 64GB of storage. </para>
      <para> While the &t.server; supports various usage scenarios,
        depending on the existing infrastructure, it's designed to be
        cloud-native and OS agnostic. As such, the default installation
        method provisions a minimal, single node, K3S &k8s; cluster for
        running its components in Linux containers. The &t.server; can
        be installed on the following services: </para>
      <!--
        toms 2021-12-06: taken from "Draft - Various Tidbits regarding Productization"
        (https://confluence.suse.com/x/tgCnMg)
      -->
      <itemizedlist>
        <listitem>
          <para>RKE1 (&rancher.k8s.engine; version 1)</para>
        </listitem>
        <listitem>
          <para>RKE2</para>
        </listitem>
        <listitem>
          <para>any other CNCF certified &k8s;</para>
        </listitem>
      </itemizedlist>
    </section>
    <section xml:id="sec-trento-agent-requirements">
      <title>&t.agent; requirements</title>
      <para> The resource footprint of the &t.agent; is designed to not
        impact the performance of the host it runs on. </para>
      <para> The &t.agent; component needs to interact with several
        low-level system components that are part of the &productname;
        distribution. </para>
    </section>
    <section xml:id="sec-trento-network-requirements">
      <title>Network requirements</title>
      <para />
      <remark>toms 2021-12-02: which ports do we need?</remark>
      <itemizedlist>
        <listitem>
          <para> Ensure that the Trento component running &k8s; has a
            network access to the &sap; landscape. </para>
        </listitem>
        <listitem>
          <para>
            <remark>toms 2021-12-06: do we have UDP here
              too?</remark> The &t.server; needs to reach its
            &t.agent;s hosts via SSH (port TCP/22). </para>
        </listitem>
        <listitem>
          <para> The &t.server; must be reachable from the &sap;
            administrator's LAN via HTTP (port TCP/80). </para>
        </listitem>
      </itemizedlist>
    </section>

    <section xml:id="sec-trento-installation-prerequisites">
      <title>Installation pre-requisites</title>
      <itemizedlist>
        <listitem>
          <formalpara>
            <title>&t.server;</title>
            <para>Access to &suse; registry for the deployment of &t.server; premium containers.</para>
          </formalpara>
        </listitem>
        <listitem>
          <formalpara>
            <title>&t.agent;s</title>
            <para>A registered &productname; distribution.</para>
          </formalpara>
        </listitem>
        <listitem>
          <formalpara>
            <title>A Trento service user</title>
            <para> Able to sudo to root without password in the &t.agent; hosts. In this example, we
              will refer to it as <systemitem class="username"
                >&trentoadmin;</systemitem>. You can use any
              desired user name, but we recommend you use it
              consistently across the landscape. </para>
          </formalpara>
        </listitem>
      </itemizedlist>
    </section>
  </section>

  <section xml:id="sec-trento-installing-trentoserver">
    <title>Installing &t.server;</title>
<!--    https://confluence.suse.com/display/SAP/Installing+Trento+Premium-->
    <important>
      <title>Expect changes in the installation procedure</title>
      <para>
        The product is under active development. Expect changes in the described
        installation procedure.
      </para>
    </important>

    <para> The procedure uses the following placeholders: </para>
    <itemizedlist>
      <listitem>
        <para><replaceable>TRENTO_SERVER_HOSTNAME</replaceable>: the
          host name of the &t.server; host.</para>
      </listitem>
      <listitem>
        <para><replaceable>PRIVATE_SSH_KEY</replaceable>: the absolute path to the private
          SSH key that &t.server; will use to connect to the &t.agent; hosts.
        </para>
      </listitem>
    </itemizedlist>

    <para>
      &t.server; premium is delivered as a Helm chart in order to facilitate its
      installation process. If you already have a &k8s; cluster in place and
      want to use it to run &t.server;, all you have to do is to install Helm
      (<xref linkend="st-install-helm"/>) and then run command in <xref linkend="st-deploy-k3s"/>
      to deploy the Helm chart in your &k8s; cluster.
      If you don't have a &k8s; cluster or have one but don't want to use it for
      Trento, you can deploy a small VM (see section <xref linkend="sec-trento-server-requirements"/>
      for minimum requirements) and follow steps in <xref linkend="pro-trento-manually-installing"/>
      to get &t.server; up and running.
    </para>

    <para>
      If you choose to deploy the VM with a registered SLES for SAP 15 distro,
      instead of executing <xref linkend="st-install-k3s"/> thru
      <xref linkend="st-deploy-k3s"/>, you can install package
      <filename>trento-premium-server-installer</filename> and then execute script
     <filename>install-trento-server</filename>: it will run those steps for you automatically.
    </para>

    <procedure xml:id="pro-trento-manually-installing">
      <title>Manually installing Trento on a &t.server; host</title>
      <step>
        <para> Log on the &t.server; host.
        </para>
      </step>
      <step xml:id="st-install-k3s">
        <para>Install &k8s;, for example, K3s for a single server install:</para>
        <stepalternatives>
          <step>
            <para>Installing as user &rootuser;</para>
            <screen>&prompt.root;curl -sfL https://get.k3s.io | INSTALL_K3S_SKIP_SELINUX_RPM=true sh</screen>
          </step>
          <step>
            <para>Installing as non-&rootuser; user:</para>
            <screen>&prompt.user;curl -sfL https://get.k3s.io | INSTALL_K3S_SKIP_SELINUX_RPM=true sh -s - --write-kubeconfig-mode 644</screen>
          </step>
        </stepalternatives>
      </step>
      <step xml:id="st-install-helm">
        <para>Install Helm as &rootuser;:</para>
        <screen>&prompt.root;curl https://raw.githubusercontent.com/helm/helm/master/scripts/get-helm-3 | bash</screen>
      </step>
      <step>
        <para>Export the <envar>KUBECONFIG</envar> environment variable for the
          same user that installed K3s:
        </para>
        <screen>export KUBECONFIG=/etc/rancher/k3s/k3s.yaml</screen>
      </step>
      <step xml:id="st-deploy-k3s">
        <para>
          With the same user that installed K3s, install the &t.server; container
          using Helm:
        </para>
        <screen>HELM_EXPERIMENTAL_OCI=1 helm upgrade \
   --install trento-server \
   oci://registry.suse.com/trento/trento-server \
   --version 0.4.4 \
   --set-file trento-runner.privateKey=<replaceable>PRIVATE_SSH_KEY</replaceable></screen>
      </step>
      <step>
        <para> Log out the &t.server; host. </para>
      </step>
      <step>
        <para> To verify that the &t.server; installation was
          successful, open the URL of the &t.web;
          (<uri>http://<replaceable>TRENTO_SERVER_HOSTNAME</replaceable></uri>)
          from a workstation located in the &sap; administrator's LAN. </para>
      </step>
    </procedure>
  </section>

  <section xml:id="sec-trento-installing-trentoagent">
    <title>Installing &t.agent;s</title>
    <important>
      <title>Expect changes in the installation procedure</title>
      <para>
        The product is under active development. Expect changes in the described
        installation procedure.
      </para>
    </important>

    <para> Repeat the following steps on each host to be monitored in your
      &sap; Environment. </para>
    <para> The procedure uses the following placeholders: </para>
    <itemizedlist>
      <listitem>
        <para><replaceable>TRENTO_SERVER_IP</replaceable>: local IP
          address of the &t.server; host.</para>
      </listitem>
      <listitem>
        <para><replaceable>TRENTO_AGENT_IP</replaceable>: local IP
          address of the &t.agent; host.</para>
      </listitem>
      <listitem>
        <para><replaceable>TRENTO_AGENT</replaceable>: host name of the
          &t.agent; host.</para>
      </listitem>
    </itemizedlist>
    <para> To install the &t.agent; software on the host and register it
      with the &t.server;, proceed as follows: </para>
    <procedure xml:id="pro-trento-installing-trentoagent">
      <title>Installing &t.agent;s</title>
      <step xml:id="step-trento-installing-trentoagent-sshkey">
        <para>
          On the &t.agent; host, add the public SSH key used for the
          installation of &t.server; to the <filename>~/.ssh/authorized_keys</filename>
          file of the user <systemitem
          class="username">&trentoadmin;</systemitem>.
          This step is necessary to enable the runner checks in the
          &t.agent; host via SSH.
        </para>
      </step>
      <step xml:id="step-trento-installing-trentoagent-knownhosts">
        <para> Add the &t.agent; host to the list of known hosts on your
          &t.server; by logging in once via SSH as <systemitem
            class="username">&trentoadmin;</systemitem>: </para>
        <substeps>
          <step>
            <para> Log in on the &t.server; host.
            </para>
          </step>
          <step>
            <para> Connect to the &t.agent; host as <systemitem
              class="username">&trentoadmin;</systemitem> using SSH and
              answer <literal>yes</literal> when asked whether to
              continue or not with the connection process: </para>
            <screen>&prompt.user;ssh &trentoadmin;@<replaceable>TRENTO_AGENT_IP</replaceable>
[...]
Are you sure you want to continue connecting (yes/no/[fingerprint])? <emphasis role="strong">yes</emphasis>
Warning: Permanently added '<replaceable>TRENTO_AGENT_IP</replaceable>' (ECDSA) to the list of known hosts.</screen>
          </step>
          <step>
            <para>
              Log out to go back to the &t.agent; host.
            </para>
          </step>
        </substeps>
      </step>
      <step>
        <para>
          Install the package:
        </para>
        <screen>&prompt.user;sudo zypper ref
&prompt.user;sudo zypper install trento-premium</screen>
      </step>
      <step>
        <para>
          Open the configuration file <filename>/etc/trento/agent.yml</filename>
          and uncomment (<literal>#</literal>) the entries for
          <parameter>ssh-address</parameter> and <parameter>collector-host</parameter>
          and update the values appropriately.
        </para>
      </step>
      <step>
        <para>
          Start the &t.agent;:
        </para>
        <screen>&prompt.user;sudo systemctl enable --now trento-agent</screen>
      </step>
      <step>
        <para>Check the status of the &t.agent;:</para>
        <screen>&prompt.user;sudo systemctl status trento-agent
● trento-agent.service - &t.agent; service
     Loaded: loaded (/usr/lib/systemd/system/trento-agent.service; enabled; vendor preset: disabled)
     Active: active (running) since Wed 2021-11-24 17:37:46 UTC; 4s ago
   Main PID: 22055 (trento)
      Tasks: 10
     CGroup: /system.slice/trento-agent.service
             ├─22055 /usr/bin/trento agent start --consul-config-dir=/srv/consul/consul.d
             └─22220 /usr/bin/ruby.ruby2.5 /usr/sbin/SUSEConnect -s

[...]</screen>
      </step>
      <step>
        <para> Repeat this procedure in all &t.agent; hosts. </para>
      </step>
    </procedure>
  </section>

  <section xml:id="sec-trento-webconsole">
    <title>Using &t.web;</title>
    <remark>toms 2021-12-13: this section is a bit too referential and needs
      more focus on the user. As discussed with Alberto, we keep it for
      the time being and change it after the release. </remark>
    <para>
      When you access the Trento web console for the first time, it asks
      to accept the license. Click <guimenu>Accept</guimenu> to continue.
      <remark>toms 2022-01-14: should we include the license page?</remark>
    </para>
    <para>
      After you have accepted the license, Trento can be used.
      The left sidebar in the &t.web; contains the following entries: </para>
    <itemizedlist>
      <listitem>
        <formalpara>
          <title><guimenu>Home</guimenu></title>
          <para> It gives an overview of the Trento project. </para>
        </formalpara>
      </listitem>
      <listitem>
        <formalpara>
          <title><guimenu>Hosts</guimenu></title>
          <para>Lists all registered hosts running the
            &t.agent;.</para>
        </formalpara>
      </listitem>
      <listitem>
        <formalpara>
          <title><guimenu>&pace; Clusters</guimenu></title>
          <para>Lists all discovered &pace; clusters.</para>
        </formalpara>
      </listitem>
      <listitem>
        <formalpara>
          <title><guimenu>&sap; Systems</guimenu></title>
          <para>Lists all discovered &sap; Systems; identified by the
            corresponding system IDs. </para>
        </formalpara>
      </listitem>
      <listitem>
        <formalpara>
          <title><guimenu>HANA Database</guimenu></title>
          <para> Lists all discovered &hana; databases identified by
            the corresponding system IDs. </para>
        </formalpara>
      </listitem>
      <listitem>
        <formalpara>
          <title><menuchoice>
            <guimenu>Settings</guimenu>
            <guimenu>Checks catalog</guimenu>
          </menuchoice></title>
          <para>Shows the catalog of configuration checks that Trento
            may carry out for different cluster components (&pace;,
            &corosync; SBD, etc.).</para>
        </formalpara>
      </listitem>
      <listitem>
        <formalpara>
          <title><menuchoice>
            <guimenu>Settings</guimenu>
            <guimenu>About</guimenu>
          </menuchoice></title>
          <para>Shows the current Trento version, the link to the
            GitHub repository of Trento, the type of subscription
            and the number of registered &productname; hosts
            .</para>
        </formalpara>
      </listitem>
    </itemizedlist>
    <para> The following subsections provides an overview of Trento's
      functionality. </para>

    <section xml:id="sec-trento-web-home-page">
      <title>Home page</title>
      <para> The home page allows you to determine at a glance the Health Status of your &sap; environment. </para>
      <figure>
        <title>Hosts page</title>
        <mediaobject>
          <imageobject>
            <imagedata width="80%" fileref="trento-web-home.png" />
          </imageobject>
        </mediaobject>
      </figure>
      <para>
        The Global Health section on top shows a summary of the Health Status of the registered &sap; systems.
      </para>
      <para> The Health Status of a registered &sap; system is the compound of its Health Status at four
        diferent layers, which are a reflection of the &sap; architecture:</para>
      <itemizedlist>
        <listitem>
          <formalpara>
            <title><guimenu>Hosts</guimenu>:</title>
            <para>it collects the running status of the Trento Agent and the Node Exporter.</para>
          </formalpara>
        </listitem>
        <listitem>
          <formalpara>
            <title><guimenu>&pace; Clusters</guimenu>:</title>
            <para>the status here is based on the running status of the cluster and the results
              of the configuration checks.</para>
          </formalpara>
        </listitem>
        <listitem>
          <formalpara>
            <title><guimenu>Database</guimenu>:</title>
            <para>it collects the status of the HANA instances as returned by <command>sapcontrol</command>.</para>
          </formalpara>
        </listitem>
        <listitem>
          <formalpara>
            <title><guimenu>SAP instances</guimenu>:</title>
            <para>it summarizes the status of the ABAP instances as returned by <command>sapcontrol</command>.</para>
          </formalpara>
        </listitem>
      </itemizedlist>
      <para> A grey status is returned when either a component is not present or it is stopped
        (as returned by <command>sapcontrol</command>) or it is unknown (for instance if a command
        to determine the status fails).</para>
      <para> Grey statuses are not counted in the calculation of the Global Health status.</para>
    </section>

    <section xml:id="sec-trento-web-hosts">
      <title>Hosts view</title>
      <para> To display the lists of registered hosts, click the
        <guimenu>Hosts</guimenu> entry in the left sidebar. </para>
      <figure>
        <title>Hosts entry</title>
        <mediaobject>
          <imageobject>
            <imagedata width="80%" fileref="trento-web-hosts.png" />
          </imageobject>
        </mediaobject>
      </figure>
      <para> This view provides the following information: </para>
      <itemizedlist>
        <listitem>
          <para> A <guimenu>Health</guimenu> section on top with a
            summary of the health status of the registered hosts.
          </para>
        </listitem>
        <listitem>
          <para> A <emphasis role="bold">list</emphasis> of registered hosts
            with the following info for each one of them: Health Status
            (Passing, Warning or Critical), host name and local IP address. If
            applicable, it shows cloud provider, cluster name, and system ID.
            Otherwise all fields are empty.
            The row ends with the &t.agent;'s version and custom tags that you
            can add and remove manually. </para>
        </listitem>
        <listitem>
          <para> Ability to <emphasis role="bold">filter</emphasis> the list by
            health status, &sap; System ID, or custom tags. </para>
        </listitem>
      </itemizedlist>

      <para> Clicking on a host name opens the corresponding <guimenu>Host
        details</guimenu> view, where you can see the following: </para>
      <itemizedlist xml:id="lst-trento-web-hosts-details">
        <title>Host details view</title>
        <listitem>
          <para><guimenu>Hosts details</guimenu> section: it shows a monitoring
            dashboard to display CPU and memory usage for the specific host.
            Additionally, the page provides the host name, the &sap;
            System ID (when applicable); the cluster name (when applicable)
            and the &t.agent; version.
          </para>
          <informalfigure>
            <mediaobject>
              <imageobject>
                <imagedata width="60%" fileref="trento-web-hosts-dashboard-cpu-memory.png"/>
              </imageobject>
            </mediaobject>
          </informalfigure>
        </listitem>
        <listitem>
          <para><guimenu>Cloud details</guimenu> section: when
            applicable, it provides the name of the virtual machine,
            the name of the resource group it belongs to, the
            location, the size of the virtual machine, and other
            information. </para>
        </listitem>
        <listitem>
          <para><guimenu>&suse; subscription details</guimenu>
            section: it lists the different components or modules
            that are part of the subscription and for each one of
            them it provides the architecture, the version and type,
            the registration and subscription status as well as the
            start and end dates of the subscription. </para>
        </listitem>
        <listitem>
          <para><guimenu>Trento Agent status</guimenu> section: it
            shows the status and output of the corresponding
            &t.agent;. </para>
        </listitem>
        <listitem>
          <para><guimenu>&sap; instances</guimenu> section: lists the ID, SID,
            type, the features, and instance number.</para>
        </listitem>
      </itemizedlist>
    </section>

    <section xml:id="sec-trento-show-pacemaker-clusters">
      <title>&pace; clusters</title>
      <para> To display a list of the discovered &pace; clusters, click
        the <guimenu>&pace; Clusters</guimenu> entry on the left
        sidebar. </para>
      <important>
        <para> Keep in mind that during introductory phase only &hana;
          scale-up clusters are currently under consideration. </para>
      </important>
      <figure>
        <title>&pace; clusters</title>
        <mediaobject>
          <imageobject>
            <imagedata width="80%"
              fileref="trento-web-pacemaker.png" />
          </imageobject>
        </mediaobject>
      </figure>
      <para> This view provides the following: </para>
      <itemizedlist>
        <listitem>
          <para> A <guimenu>Health</guimenu> section on top providing
            a summary of the &pace; clusters status based on the
            selected configuration checks for each one of them. See
            <xref linkend="lst-trento-web-cluster-details" />
            for more information. </para>
        </listitem>
        <listitem>
          <para> A <guimenu>Filters</guimenu> section to filter clusters by
            health status, cluster name, SID, type, or tags. </para>
        </listitem>
        <listitem>
          <para> A list of registered clusters with the following
            information for each one of them: status (based on
            configuration checks), cluster name, cluster ID, cluster
            type, SID (when applicable), number of hosts, number of
            resources, and custom tags that can added/removed
            manually. </para>
        </listitem>
      </itemizedlist>
      <remark>No Settings menu anymore.</remark>
      <para> Clicking on the name or ID of a &hana; scale-up cluster, opens the
        <guimenu>&pace; Cluster details</guimenu> page in which we
        can find the following: </para>
      <itemizedlist xml:id="lst-trento-web-cluster-details">
        <title><guimenu>&pace; Cluster details</guimenu> view</title>
        <listitem>
          <para> A <guimenu>Settings</guimenu> button next to the
            <guimenu>&pace; Cluster details</guimenu> title which
            will open the Cluster settings window:
            <xref
              linkend="fig-trento-web-pagemaker-cluster-settings"
            />. </para>
          <figure xml:id="fig-trento-web-pagemaker-cluster-settings">
            <title>&pace; <guimenu>Cluster
              settings</guimenu></title>
            <mediaobject>
              <imageobject>
                <imagedata width="40%"
                  fileref="trento-web-pacemaker-cluster-settings.png"
                />
              </imageobject>
            </mediaobject>
          </figure>
          <para> In this window you can change the following settings: </para>
          <itemizedlist xml:id="lst-trento-web-pace-cluster-settings">
            <title><guimenu>Cluster settings</guimenu></title>
            <listitem>
              <para><guimenu>Connection settings</guimenu>: set
                the Trento administrator that is used to connect
                to your hosts. In this article, it is
                <systemitem class="username"
                  >&trentoadmin;</systemitem>. </para>
            </listitem>
            <listitem>
              <para>
                <guimenu>Checks selection</guimenu>:
                select/deselect a complete category of a test
                (such as &corosync;, &pace; etc.) or individual
                tests. </para>
            </listitem>
          </itemizedlist>
          <para> Do not forget to save your changes before closing the
            window. </para>
        </listitem>
        <listitem>
          <para>On the top left, a section with the most relevant
            cluster attributes including &hana; system replication
            mode, &hana; system replication operation mode,
            SAPHanaSR health state and &hana; secondary sync state. </para>
          <informalfigure>
            <mediaobject>
              <imageobject>
                <imagedata width="60%"
                  fileref="trento-web-pagemaker-cluster-details-header.png"
                />
              </imageobject>
            </mediaobject>
          </informalfigure>
        </listitem>
        <listitem>
          <para>On the top right side, a <guimenu>Health</guimenu>
            section with number of configuration checks in Passing,
            Warning or Critical status. For detail information on
            the different configuration checks, click on
            <guimenu>Show check results</guimenu> button. This
            view gives you a brief overview of passed and failed
            checks. The <guimenu>Health Details</guimenu> view can
            be shortened by <xref
              linkend="lst-trento-web-pace-cluster-settings" />.
            There, you can select the tests to include in the view. </para>
          <informalfigure>
            <mediaobject>
              <imageobject>
                <imagedata width="20%"
                  fileref="trento-web-pagemaker-cluster-details-health.png"
                />
              </imageobject>
            </mediaobject>
          </informalfigure>
        </listitem>
        <listitem>
          <para> A <guimenu>Stopped resources</guimenu> section
            listing all stopped resources in the current &pace;
            cluster. </para>
        </listitem>
        <listitem>
          <para>A <guimenu>&pace; Site details</guimenu> section
            showing the different sites that are configured for this
            cluster. For each site, its name is displayed along with
            the host name, the local IP, the virtual IP and the role
            of the corresponding node. Clicking on the host name
            takes you to the corresponding <xref
              linkend="lst-trento-web-hosts-details" />. Clicking
            on the <guimenu>Details</guimenu> button to the right
            opens a window with two tabs: in one tab you can see the
            main attributes of the node, in the other one you can
            see the list of resources running on it. </para>
          <informalfigure>
            <mediaobject>
              <imageobject>
                <imagedata width="60%"
                  fileref="trento-web-pacemaker-cluster-site.png"
                />
              </imageobject>
            </mediaobject>
          </informalfigure>
        </listitem>
        <listitem>
          <para>A <guimenu>SBD/Fencing</guimenu> section listing the
            configured SBD devices and their location. </para>
        </listitem>
      </itemizedlist>
    </section>

    <section xml:id="sec-trento-sap-systems-view">
      <title>&sap; Systems view</title>
      <para> Click the <guimenu>&sap; Systems</guimenu> entry in the left
        sidebar to get an overview of the registered &sap; Systems: </para>
      <figure>
        <title>&pace; clusters</title>
        <mediaobject>
          <imageobject>
            <imagedata width="80%"
              fileref="trento-web-sapsystems.png" />
          </imageobject>
        </mediaobject>
      </figure>
      <para> This view provides the following: </para>
      <itemizedlist>
        <listitem>
          <para> A list of registered &sap; Systems with the following
            information for each one of them: system ID (SID),
            description, ID of the corresponding database,
            corresponding tenant name, DB IP address, and custom
            tags that you can manually set/remove. By clicking on
            the down arrow icon left to the SID, a list with all the
            instances that part of this &sap; System, including
            database instances, is displayed and for each one of
            them you can see the corresponding SID, the features
            (processes) it provides, the instance number, the
            cluster name (when applicable) and the host where it is
            running. </para>
        </listitem>
        <listitem>
          <para> Ability to filters &sap; Systems by SID and tags.
          </para>
        </listitem>
      </itemizedlist>

      <para> Clicking on a <guimenu>SID</guimenu> entry, opens up the
        <guimenu>SAP Systems</guimenu> details view which displays
        the following: </para>
      <itemizedlist>
        <title>&sap; System details</title>
        <listitem>
          <para>the <guimenu>Name</guimenu> and
            <guimenu>Type</guimenu> of this &sap; System.</para>
        </listitem>
        <listitem>
          <para>
            <guimenu>The NetWeaver; instances layout</guimenu>: for
            each instance, virtual host name, instance number,
            features (processes), HTTP and HTTPS ports, start
            priority, and SAPControl status. </para>
        </listitem>
        <listitem>
          <para>
            <guimenu>The list of hosts where the different NetWeaver
              instances are running</guimenu>, with the host name,
            the IP address, the cloud provider (when applicable),
            the cluster name (when applicable), the &sap; System ID,
            and the &t.agent; version for each listed host. When you
            click the host name, it shows you the details described
            in <xref linkend="lst-trento-web-hosts-details" />.
          </para>
        </listitem>
      </itemizedlist>
    </section>

    <section xml:id="sec-trento-hana-db-view">
      <title>&hana; databases view</title>
      <para> To get an overview of registered &hana; databases, click the
        <guimenu>HANA databases</guimenu> entry in the left sidebar. </para>
      <figure>
        <title>HANA databases</title>
        <mediaobject>
          <imageobject>
            <imagedata width="80%" fileref="trento-web-hanadb.png"
            />
          </imageobject>
        </mediaobject>
      </figure>
      <para>This view provides the following:</para>
      <itemizedlist>
        <listitem>
          <para> A list of registered &hana; databases with the
            following information for each one of them: system ID
            (SID), description, and custom tags that you can
            manually set/remove. By clicking on the down arrow icon
            left to the SID, a list of all related instances is
            displayed and for each one of them you can see the
            corresponding SID, the features (processes) it provides,
            the instance number, the system replication role, the
            cluster name (when applicable) and the host where it is
            running. </para>
        </listitem>
        <listitem>
          <para> Ability to filters &hana; databases by SID and tags.
          </para>
        </listitem>
      </itemizedlist>
      <para> Clicking on one of the <guimenu>SID</guimenu>s opens the
        <guimenu>HANA Databases</guimenu> detail view which shows
        the following: </para>
      <itemizedlist>
        <title><guimenu>HANA Database</guimenu> details view</title>
        <listitem>
          <para>
            <guimenu>Layout</guimenu> section: lists all related
            &hana; instances with their corresponding host name,
            instance number, features (processes), HTTP/HTTPS ports,
            start priorities, and SAPControl status. </para>
        </listitem>
        <listitem>
          <para>
            <guimenu>Hosts</guimenu> section: lists the hosts where
            all the related instances are running and for each host
            it provides the host name, the local IP address, the
            cloud provider (when applicable), the cluster name (when
            applicable), the system ID, and the &t.agent; version. </para>
          <para> Clicking on a host name takes you to the
            corresponding <xref
              linkend="lst-trento-web-hosts-details" />. </para>
        </listitem>
      </itemizedlist>
    </section>

    <section xml:id="sec-trento-configuration-checks">
      <title>Configuration checks</title>
      <para> To get an overview of the configuration checks that Trento
        can manage click the <menuchoice>
          <guimenu>Settings</guimenu>
          <guimenu>Checks catalog</guimenu>
        </menuchoice> entry in the left sidebar. </para>
      <figure>
        <title><menuchoice>
          <guimenu>Settings</guimenu>
          <guimenu>Checks catalog</guimenu>
        </menuchoice></title>
        <mediaobject>
          <imageobject>
            <imagedata width="80%"
              fileref="trento-web-settings-catalogs.png" />
          </imageobject>
        </mediaobject>
      </figure>
      <para> The view shows the configuration checks that Trento can
        perform for the different cluster components: &corosync;,
        &pace;, SBD, Azure Fence Agent, &hana; System Replication
        Resource Agent, OS and package version, and miscellaneous. </para>
      <para> Checks are grouped by components. Each test is identified by
        a test ID, next to which we can see the check description and an
        info icon. By clicking on the info icon we get detail
        information about the corresponding check: abstract, remediation
        actions (what to do when the check is negative) and related
        references. </para>
      <para> What checks are carried out for each particular cluster is
        determined using the <guimenu>Settings</guimenu> button in the
        corresponding cluster detail view. See <xref
          linkend="lst-trento-web-pace-cluster-settings" /> for
        details. </para>
    </section>
  </section>

  <section xml:id="sec-trento-updating-trentoserver">
    <title>Updating &t.server;</title>
    <para> To update the &t.server;, do the following: </para>
    <procedure>
      <step>
        <para> Ensure the &t.server; is running. </para>
      </step>
      <step>
        <para>
          Ensure that credentials for Kubernetes are set up correctly.
          For example, if you run K3s, export the <envar>KUBECONFIG</envar>
          environment variable:
        </para>
        <screen>export KUBECONFIG=/etc/rancher/k3s/k3s.yaml</screen>
      </step>
      <step>
        <para>
          With the same user that installed &t.server; initially, start the
          update of the &t.server;:
        </para>
        <screen>HELM_EXPERIMENTAL_OCI=1 helm upgrade \
   --install trento-server \
   oci://registry.suse.com/trento/trento-server \
   --version 0.4.3 \
   --set-file trento-runner.privateKey=<replaceable>PRIVATE_SSH_KEY</replaceable>
        </screen>
      </step>
      <step>
        <para>Check the &t.server; processes:</para>
        <screen>kubectl get pod</screen>
      </step>
      <step>
        <para> Open the &t.web; URL
          <uri>http://<replaceable>TRENTO_SERVER_HOSTNAME</replaceable></uri>.
        </para>
      </step>
      <step>
        <para> To check the new version, hover the mouse pointer over
          the info button in the lower-left corner. </para>
      </step>
    </procedure>
  </section>

  <section xml:id="sec-trento-updating-trentoagent">
    <title>Updating a &t.agent;</title>
    <para>
      The following procedure expects that your &t.agent; has the SSH key and is
      listed as known hosts on your &t.server; as explained
      in <xref linkend="step-trento-installing-trentoagent-sshkey"/> and
      <xref linkend="step-trento-installing-trentoagent-knownhosts"/> of
      <xref linkend="pro-trento-installing-trentoagent"/>.
    </para>
    <para>
      To update the &t.agent;, do the following:
    </para>
    <procedure>
      <step>
        <para>Log in the &t.agent; host.</para>
      </step>
      <step>
        <para>Stop the &t.agent;:</para>
        <screen>&prompt.user;sudo systemctl stop trento-agent</screen>
      </step>
      <step>
        <para>
          Install the package:
        </para>
        <screen>&prompt.user;sudo zypper ref
&prompt.user;sudo zypper install trento-premium</screen>
      </step>
      <step>
        <para>
          Restart the &t.agent;:
        </para>
        <screen>&prompt.user;sudo systemctl restart trento-agent</screen>
      </step>
      <step>
        <para>Check the status of the &t.agent;:</para>
        <screen>&prompt.user;sudo systemctl status trento-agent
● trento-agent.service - &t.agent; service
     Loaded: loaded (/usr/lib/systemd/system/trento-agent.service; enabled; vendor preset: disabled)
     Active: active (running) since Wed 2021-11-24 17:37:46 UTC; 4s ago
   Main PID: 22055 (trento)
      Tasks: 10
     CGroup: /system.slice/trento-agent.service
             ├─22055 /usr/bin/trento agent start --consul-config-dir=/srv/consul/consul.d
             └─22220 /usr/bin/ruby.ruby2.5 /usr/sbin/SUSEConnect -s

[...]</screen>
      </step>
      <step>
        <para>Check the version on the &t.web; (URL
              <uri>http://<replaceable>TRENTO_SERVER_HOSTNAME</replaceable></uri>).</para>
      </step>
      <step>
        <para> Repeat this procedure in all &t.agent; hosts. </para>
      </step>
    </procedure>

  </section>

   <section xml:id="sec-trento-uninstall-trentoserver">
    <title>Uninstalling &t.server;</title>
    <para> To uninstall &t.server;, proceed as follows:</para>
    <procedure>
      <step>
        <para>
          Ensure that credentials for Kubernetes are set up correctly.
          For example, if you run K3s, export the <envar>KUBECONFIG</envar>
          environment variable:
        </para>
        <screen>export KUBECONFIG=/etc/rancher/k3s/k3s.yaml</screen>
      </step>
      <step>
        <para>
          With the same user that installed &t.server;, run the following command:
        </para>
        <screen>helm uninstall trento-server</screen>
      </step>
    </procedure>
  </section>

  <section xml:id="sec-trento-uninstall-trentoagent">
    <title>Uninstalling a &t.agent;</title>
    <para>
      To uninstall a &t.agent;, perform the following steps:
    </para>
    <procedure>
      <step>
        <para>Log in the &t.agent; host.</para>
      </step>
      <step>
        <para>Stop the &t.agent;:</para>
        <screen>&prompt.user;sudo systemctl stop trento-agent</screen>
      </step>
      <step>
        <para>
          Remove the package:
        </para>
        <screen>&prompt.user;sudo zypper remove trento-premium</screen>
      </step>
    </procedure>
  </section>
 
  <section xml:id="sec-trento-more-information">
    <title>More information</title>
    <itemizedlist>
      <listitem>
        <para>Homepage: <link xlink:href="https://www.trento-project.io/"/></para>
      </listitem>
      <listitem>
        <para>Trento project: <link xlink:href="https://github.com/trento-project/trento"/></para>
      </listitem>
    </itemizedlist>
  </section>
  <!--<xi:include href="common_legal.xml"/>-->
</article>
